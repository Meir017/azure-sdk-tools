
<p-contextMenu #cm [model]="contextMenuItems"></p-contextMenu>
<p-table
    #reviewsTable
    [rows]="noOfRows"
    [value]="reviews"
    dataKey="id"
    [scrollable]="true"
    scrollHeight="flex"
    responsiveLayout="stack"
    [lazy]="true"
    [lazyLoadOnInit]="false"
    [virtualScroll]="true"
    [virtualScrollDelay]="0"
    [virtualScrollItemSize]="rowHeight"
    [(contextMenuSelection)]="selectedReview"
    [contextMenu]="cm"
    [customSort]="true"
    (onLazyLoad)="onLazyLoad($event)"
    (onSort)="onSort($event)"
    (onFilter)="onFilter($event)"
    selectionMode="single"
    [(selection)]="selectedReview"
    (onRowSelect)="onRowSelect($event)"
    [tableStyle]="{ 'min-width': '10rem' }"
    styleClass="p-datatable-sm">
    <ng-template pTemplate="caption">
        <div class="d-flex justify-content-between index-table-info">
            <div>
                <p-chip *ngFor="let lang of selectedLanguages" label="{{ lang.data }}"></p-chip>
            </div>
            <div>
                <button *ngIf="tableHasFilters()" (click)="clear(reviewsTable)" type="button" class="btn btn-sm btn-outline-primary"><i class="bi bi-x-circle me-1"></i>Filters</button>
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <tr>
            <th style="width:20%">Lanuage</th>
            <th pSortableColumn="packageName" style="width:auto">Review - Package Name<p-sortIcon class="ms-2" field="packageName"></p-sortIcon></th>
        </tr>
        <tr>
            <th>
                <p-columnFilter id="langauge-filter" field="languages" matchMode="in" [showMenu]="false">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                        <p-multiSelect [ngModel]="value" [appendTo]="reviewsTable" [options]="languages" [filter]="false" [(ngModel)]="selectedLanguages" (onChange)="filter($event.value)" optionLabel="label">
                            <ng-template let-option pTemplate="item">
                                <div class="inline-block vertical-align-middle">
                                    <img [alt]="" src="assets/images/{{ option.label | languageNames }}-original.svg" width="24" class="vertical-align-middle" />
                                    <span class="mx-2 mt-1">{{ option.label }}</span>
                                </div>
                            </ng-template>
                        </p-multiSelect>
                    </ng-template>
                </p-columnFilter>
            </th>
            <th>
                <p-columnFilter type="text" field="packageName" [showMenu]="false"></p-columnFilter>
            </th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-review>
        <tr [pContextMenuRow]="review" [pSelectableRow]="review">
            <td>
                <img class="ms-3" src="assets/images/{{ review.language | languageNames }}-original.svg" alt="{{review.language}}" width="25">
            </td>
            <td style="word-wrap: break-word; max-width: 10ch">{{ review.packageName }}</td>
        </tr>
    </ng-template>
    <ng-template pTemplate="summary">
        <div class="flex align-items-center justify-content-center">
            {{totalNumberOfReviews}} Reviews
        </div>
    </ng-template>
</p-table>
<button type="button" (click)="sidebarVisible = true" class="btn btn-primary" id="create-review-button"><small>CREATE</small><br><i class="fas fa-plus"></i><br><small>REVIEW</small></button>
<p-sidebar [(visible)]="sidebarVisible" position="right">
    <h3>Create Review</h3>
    <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
        Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
    </p>
    <p-dropdown [options]="languages" [(ngModel)]="selectedCRLanguages" optionLabel="label"></p-dropdown>
    <p-fileUpload mode="basic" chooseLabel="Select Review File" name="demo[]" url="https://www.primefaces.org/cdn/api/upload.php" accept="image/*"></p-fileUpload>
</p-sidebar>
